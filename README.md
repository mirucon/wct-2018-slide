autoscale: true

## 自己紹介

---

### 金井俊浩 (mirucon)

* フリーランスの Web エンジニア
* 最近は Vue.js などのフロントエンドがメイン

* WordPress Core Contributor
* WordPress テーマレビューチームモデレータ
* WordPress テーマ Coldbox 開発者

^ (for TRT mod) WordPress.org に申請されるテーマをレビューし、承認したり、問題点があればそれを指摘したりする。これは誰でも参加できる。

![inline 50% right](https://secure.gravatar.com/avatar/38228223544cf5f1f818c93ecdd4371f?s=500&d=mm&r=g)

---

## このセッションの目的

* テーマ制作に興味があり、なんとなくのテーマの構造がわかっている人
* 受託開発などでテーマ制作をしたことがあるが、配布テーマを作ってみたい人

---

## テーマの基礎

---

### テーマとは

---

### テーマとは

* ウェブサイト全体の見た目からレイアウト、構成、機能まで様々な場所に影響を及ぼす、WordPress サイトの「キモ」

---

### ディレクトリ構成

* 例えばこんな感じ :

```
my-theme/
  L inc/
    L customizer.php
    L related-posts.php
  L footer.php
  L functions.php
  L header.php
  L index.php
  L readme.txt
  L screenshot.png
  L single.php
  L style.css    
```

---

### テーマでは何をするべき ?

---

### テーマでは何をするべき ?

* テーマは結局プラグインと同じただの PHP ファイルなので、やろうと思えば何だってできる

^ ただテーマテンプレートファイルは使いやすいので

* ただしテーマはプラグインと違って1つしか有効化できない

^ あまりに機能をテーマに入れすぎると、テーマを変えた時にその機能が動かなくなる事件が発生する

* そのため WordPress.org のテーマディレクトリの要求事項では「テーマは基本的に見た目を司ることのみすべき」つまり、

**=> 見た目に直接関係ない機能をテーマに入れるべきではない**

^ 例 : Open Graph タグ・

---

### テーマでは何をするべき ?

* ただしこれは WordPress.org のテーマディレクトリの話であり、他のテーマ配布サイト等では違ったりする

* 結局は個々の機能をプラグイン化するのと、テーマで一元化してすべてを管理するのは便利さとのトレードオフ

* また受託開発などでは機能自体に汎用性がない場合・なんらかの事情によってプラグインを使いにくい場合などもある

**=> 自分の制作している目的・公開範囲などを考えて、適切なところを考えよう**

^ (last) ただし、多くの人に使ってもらいやすい (管理ページからアクセスしやすいなど目立つところにある) WordPress.org テーマディレクトリの方針は覚えておこう。特に配布テーマの場合、特定のテーマに依存させてしまうのはユーザーフレンドリーではない

---

## ライセンスについて

^ どんな人にでも知っておいてほしいライセンスの話

---

### WordPress はオープンソース

* WordPress は本体がオープンソース
* GPL ライセンスを使用している
* WordPress は思想として「パブリッシングの民主化 (Democratize publishing)」を掲げている
* オープンソースなので誰でも WordPress の開発・ディスカッション・翻訳にも貢献できる

^ (for democratization) 誰でも簡単に「パブリッシング」(ネット上で記事を公開できるように) 。(今こそ様々なブログサービスがあり、当然かも知れないが WordPress のリリースは2003年)。

^ (for contributing) WordPress の貢献と聞くと難しいと思うかもしれないが、簡単なものも多い (例えば誤字修正) し、とっかかりやすくしようとみんな頑張ってる。「プラグインを作る」「テーマを作る」みんなに使ってもらうことや、開発だけでなく、WordPress についてのブログを書くことでも十分貢献。

---

### GPL ライセンスとはどんなライセンスか

* **G**eneral **P**ublic **L**icense の頭文字をとって "GPL" と呼ばれるオープンソースライセンスの一つ
* いかなる**制約なし**に無保証で**4つの自由**を認めるのが基本思想

^ 「いかなる制約なし」とは本当にどんな制約もなしに -  テーマならどんなサイトでも使えるようにするなど

---

### 4つの自由とは ?

* どんな目的にも使用する自由
* ソースコードを研究し、改変する自由
* 他の人に再配布する自由
* 改変したものを共有する自由

^ これら自体はそこまで珍しいものではない

---

### 最大の特徴コピーレフト

* コピーレフトとは、制作物の改変されたものや派生プロダクト (derivative work) にも、もとの制作物と同一の自由を認めるべきとも考え方
* WordPress の場合 :
	* **もとの制作物** = WordPress
	* **派生プロダクト** = テーマ・プラグインなど
	
=> **つまり、WordPress が GPL である限り、配布する作ったテーマ・プラグインも GPL にする義務が発生する**

^ (last) この流れは永遠に続くわけであり、WordPress の派生プロダクトを元に作られたテーマは GPL, そしてそれを元に作られた子テーマも GPL になって… といったようにずっと続く

^ (for next) ここまで聞いて、あれ、あの人気テーマは「自由」が担保されたないと思った方もいますよね

---

### 100% GPL とスプリットライセンス

* 基本的にこのコピーレフトの範囲は **PHP ファイルのみ** と考えられている
* そのため、**100% GPL** と **スプリットライセンス** の2つのライセンス方法が存在する
* 100% GPL は CSS や画像等すべてを GPL もしくはその互換ライセンスでライセンスすること
* スプリットライセンスは PHP ファイルのみを GPL とし、他リソースを非 GPL 互換ライセンスでライセンスすること = つまりテーマの中に GPL と他ライセンスが混ざることになる

---

### どっちがいいの ?

* スプリットライセンスは WordPress の「自由を認める」という思考に反する
* WordPress.org のテーマディレクトリにそのテーマを掲載できなくなる他、**WordCamp などのイベントへの登壇・運営スタッフ参加・**などが出来なくなる

---

### 配布しない場合について

* GPL は**配布する場合にのみ**適応されるライセンスであり、配布しない場合には GPL でライセンスする**必要はない**
* ただし、WordPress を使っているということは GPL 製品を使っているということ

^ GPL は変わるものではない - GPL の最初のリリースは1989年

---

## テーマの始め方

---

### スターターテーマ

---

#### _s

* Automattic 社 (JetPack プラグインの開発などをしている会社) の開発するスターターテーマ
* かなり中身はシンプル

---

### コーディング規約

* コーディング規約とは、**コードの書き方**についての決まりごと
* WordPress には **WordPress Coding Standards** という、WordPress 専用の規約がある
* これはコードのフォーマットだけでなく、後で触れる**セキュリティ**に関することも指摘してくれる

^ ぜひ知っておいてもらいたいもの

---


### WordPress Coding Standards

* 例えば :

```php
if( is_single()) {
```

のようなものを以下のように矯正できる :

```php
if ( is_single() ) {
```

---

<!--ここにもうちょっとあるといいかも-->

### 役立つとき

* 複数人開発する時に、コードの書き方の癖をなくせる
* 一人開発でも、

^ 自動修正もできる

---

## セキュリティについて

---

### 大きく2つのセキュリティ対策

* エスケープ
* サニタイズ

---

### エスケープ

=> データを**出力するとき**に

---


### サニタイズ

=> データを保存するとき

---

## メンテナンスをしやすくするには

---

### ディレクトリ構成

---

## WordPress.org テーマディレクトリ掲載にあたって

### 要求事項

---

Remaining things to write about:

* セキュリティについて (エスケープとサニタイズ)
* メンテナンスをしやすくするには (コーディング規約・ディレクトリ構成・など)
* WordPress.org テーマディレクトリの掲載にあたって